---
title: "Rust でポモドーロ/ワークアウトCLIタイマーを作った"
description: "CLI で動作するポモドーロ･ワークアウトインターバルタイマーをRust で自作してみた"
date: "2025/11/03"
page: false
published: true
# tags: ["Rust", "Personal Project" ]
---


## はじめに

リモートワークで利用する簡易的で作業してるTerminal で起動できるポモドーロタイマーと仕事の合間に行うワークアウト向けインターバル付きタイマーが欲しくなったので今回, Rustで自作してみた.と言ってもほぼAI に書いてもらって完成してしまった..

「oxitimer」というCLIタイマーアプリケーション. ターミナル上で動作し, キーボード操作だけで完結する, 開発者フレンドリー?なタイマー.

## 特徴

### 1. 柔軟な時間設定

oxitimerは秒, 分, 時間の3つの時間フォーマットに対応しています:

```bash
# 秒単位（デフォルト）
oxitimer 25 5

# 分単位
oxitimer -w 25 -b 5 -t min

# 時間単位
oxitimer -w 1 -b 0.25 -t hour
```

ポジショナル引数と名前付き引数の両方に対応しているため, 好みのスタイルで使えます.

### 2. サイクル管理

ワークとブレイクを1サイクルとして, 指定した回数だけ繰り返すことができます:

```bash
# 3サイクル実行
oxitimer 25 5 3

# 無限ループ（サイクル数を指定しない）
oxitimer 25 5
```

最後のワークセッションが終わったら, 不要なブレイクをスキップして直接終了

### 3. カスタム音声対応

デフォルトのビープ音だけでなく, 自分の好きな音声ファイルを使用できます:

```bash
# 音声ディレクトリを初期化
oxitimer init
```

これにより `~/.config/oxitimer/sounds/` 以下に以下のディレクトリが作成されます:

- `work_end/` - ワークセッション終了時の音
- `break_end/` - ブレイクセッション終了時の音
- `at_finish/` - 全サイクル完了時の音
- `countdown/` - カウントダウン開始時の音

各ディレクトリに `.wav` または `.mp3` ファイルを配置するだけで, 自動的に使用されます.
好きなキャラとかのやついれられたらやる気出るなぁと思って実装しました. 権利とか考えるとあれですけど.(あくまで個人利用の範囲で)

### 4. プリロードによる遅延ゼロ

音声ファイルはアプリケーション起動時に全てメモリにプリロードされるため, 再生時の遅延がありません. タイマーが止まることなく, スムーズに動作します.
ただし, 起動時に事前にデータを読み込むため, データがでかいとちょっとメモリを食います.

### 5. 直感的なUI

ターミナル上に7セグメント風の大きなデジタル表示でタイマーを表示. 現在のセッションタイプ（Work/Break）, 状態（Running/Paused）, サイクルカウンターが一目で分かります.

## 使い方

### 基本的な使用例

```bash
# ポモドーロタイマー（25分作業,5分休憩,4サイクル）
oxitimer -w 25 -b 5 -c 4 -t min

# ワークアウトタイマー（30秒運動,10秒休憩,10サイクル）
oxitimer 30 10 10

# カウントダウンなしで即座に開始
oxitimer 25 5 -C 0
```

### キーボード操作

- **スペースキー** - 一時停止/再開
- **Enter** - 次のセッションにスキップ（ビープ音が鳴る）
- **Q** - 終了

## 技術的な特徴

### アーキテクチャ

レイヤードアーキテクチャを採用し, 責務を明確に分離:

- **ドメイン層** (`src/domain/`) - ビジネスロジック
  - セッション状態管理
  - タイマーロジック
  - セッションタイプ（Work/Break）

- **インフラストラクチャ層** (`src/infrastructure/`) - 外部インターフェース
  - ターミナルUIレンダリング
  - rodioによる音声再生
  - 7セグメントディスプレイ

- **アプリケーション層** (`src/main.rs`) - エントリーポイント
  - CLIパーサー
  - メインイベントループ
  - キーボード入力処理

### 使用ライブラリ

- **clap** - CLI引数パース
- **crossterm** - クロスプラットフォームなターミナル操作
- **tokio** - 非同期ランタイム
- **rodio** - 音声再生
- **anyhow** - エラーハンドリング

### 音声再生の最適化

当初, 音声再生時にタイマー表示が2秒ほど止まってしまう問題がありました. これは音声ファイルの読み込みとデコードが同期的に実行されていたためです.

解決策として, 以下の最適化を実施:

1. **起動時プリロード** - 全ての音声ファイルを起動時にメモリ上にデコード済みサンプルデータとして保存
2. **即座の再生** - 再生時はメモリから直接サンプルバッファを作成

これにより, ファイルI/Oやデコード処理が一切発生せず, 遅延なく音声が再生できるようになりました.

## インストール

```bash
git clone https://github.com/3kz2501/oxitimer.git
cd oxitimer
cargo build --release
```

バイナリは `./target/release/oxitimer` に生成されます.

## まとめ

oxitimerは, シンプルながら実用的な機能を備えたCLIタイマーアプリ(を目指しました).

主な特徴:

- ✅ 柔軟な時間フォーマット（秒/分/時間）
- ✅ サイクル管理と最適化されたフロー
- ✅ カスタム音声対応
- ✅ 遅延ゼロの音声再生
- ✅ 直感的なターミナルUI
- ✅ レイヤードアーキテクチャによる保守性

ポモドーロテクニックやワークアウトのインターバルタイマーとして, 興味があれば試してみてください.
配信とかしてるときの作業時間管理にもいいかも? ライブコーディング向けかもですが.

---

- ほぼAI に書いてもらったので間違っている箇所だったり, 非効率なところもあるかもです.一旦作って一旦公開した程度なので今後もしかしたら改善させていくかもです.

**リポジトリ**: [https://github.com/3kz2501/oxitimer](https://github.com/3kz2501/oxitimer)
**ライセンス**: MIT
